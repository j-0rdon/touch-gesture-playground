/**
 * iOS-Style Drag to Reorder Styles
 * =================================
 *
 * KEY STYLING CONCEPTS:
 *
 * 1. CONDITIONAL TRANSITIONS:
 *    - Default: NO transitions (instant snapping prevents visual glitches)
 *    - .animate class: Enables smooth transitions during active drag
 *    - .is-lifted: Fast 50ms transition for responsive finger tracking
 *    - .is-dropping: Smooth 180ms ease-out for drop animation
 *
 * 2. WHY NO DEFAULT TRANSITIONS:
 *    When items array reorders, React re-renders items in new DOM positions.
 *    If transitions are enabled, items would animate from old to new positions,
 *    causing a "magnetic repulsion" effect. Instant snapping avoids this.
 *
 * 3. VISUAL FEEDBACK BY PHASE:
 *    - pressing: Subtle background change, slight border highlight
 *    - lifted/dragging: Elevated shadow, primary colour accents
 *    - idle: Default appearance
 */

.drag-reorder-container {
  width: 100%;
  max-width: 220px;
}

.drag-reorder-list {
  display: flex;
  flex-direction: column;
  gap: 8px;  /* Must match GAP constant in TypeScript */
  position: relative;
}

/**
 * Base item styles
 * Height must match ITEM_HEIGHT constant in TypeScript (44px)
 */
.drag-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.75rem;
  background: var(--color-bg-elevated);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  cursor: grab;
  height: 44px;  /* Must match ITEM_HEIGHT constant */
  position: relative;
  overflow: hidden;
  will-change: transform;
  -webkit-user-select: none;
  user-select: none;
  touch-action: none;  /* Prevents browser gestures interfering */

  /* IMPORTANT: No default transition - items snap instantly
   * This prevents visual glitches when array reorders */
  transition: box-shadow 0.2s ease,
              background 0.15s ease,
              border-color 0.15s ease;
}

/**
 * .animate class - Added during active drag
 * Enables smooth transitions for items shifting to make room
 */
.drag-item.animate {
  transition: transform 0.15s cubic-bezier(0.25, 0.1, 0.25, 1),
              box-shadow 0.15s ease,
              background 0.15s ease,
              border-color 0.15s ease;
}

/**
 * .is-lifted class - For the item being dragged
 * Uses very fast transition (50ms) so item follows finger closely
 */
.drag-item.is-lifted {
  transition: transform 0.05s linear,
              box-shadow 0.15s ease,
              background 0.15s ease,
              border-color 0.15s ease;
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.35);
}

/**
 * .is-dropping class - For drop animation
 * Smooth ease-out creates satisfying "settle into place" feel
 */
.drag-item.is-dropping {
  transition: transform 0.18s cubic-bezier(0.25, 0.1, 0.25, 1),
              box-shadow 0.18s ease,
              background 0.15s ease,
              border-color 0.15s ease;
}

/* Coloured left border indicator */
.drag-item::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: var(--item-color);
  transition: width 0.15s ease, background 0.15s ease;
}

/* ============================================
 * PHASE-SPECIFIC STYLES
 * ============================================ */

/**
 * PRESSING PHASE
 * Subtle feedback that finger is down and holding
 */
.drag-item.pressing {
  background: var(--color-bg-card);
  border-color: var(--color-text-muted);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
}

.drag-item.pressing::before {
  width: 4px;
}

.drag-item.pressing .drag-item-handle {
  opacity: 0.6;
}

/**
 * LIFTED & DRAGGING PHASES
 * Elevated appearance with primary colour accents
 */
.drag-item.lifted,
.drag-item.dragging {
  background: var(--color-bg-card);
  border-color: var(--color-primary);
  cursor: grabbing;
}

.drag-item.lifted::before,
.drag-item.dragging::before {
  width: 4px;
  background: var(--color-primary);
}

.drag-item.lifted .drag-item-handle,
.drag-item.dragging .drag-item-handle {
  opacity: 1;
  color: var(--color-primary);
}

.drag-item.lifted .drag-item-indicator,
.drag-item.dragging .drag-item-indicator {
  opacity: 1;
  transform: scale(1.2);
}

.drag-item.dragging .drag-item-label {
  color: var(--color-primary);
}

/* ============================================
 * CHILD ELEMENT STYLES
 * ============================================ */

.drag-item-handle {
  color: var(--color-text-muted);
  font-size: 0.875rem;
  letter-spacing: -0.1em;
  opacity: 0.5;
  padding-left: 0.25rem;
  transition: opacity 0.15s ease, color 0.15s ease;
}

.drag-item-label {
  flex: 1;
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--color-text);
  transition: color 0.15s ease;
}

.drag-item-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--item-color);
  opacity: 0.7;
  transition: opacity 0.15s ease, transform 0.15s ease;
}

/* ============================================
 * UTILITY CLASSES
 * ============================================ */

/**
 * Prevents text selection on touch devices
 * Critical for drag interactions
 */
.no-select {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
